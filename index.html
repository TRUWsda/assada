<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Dark purple/blue background */
            color: #e0e0e0; /* Light grey text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            position: relative;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal-content {
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            width: 90%;
            max-width: 400px;
            text-align: center;
            position: relative;
            transform: scale(1);
            transition: transform 0.3s ease-in-out;
        }

        .modal-content:hover {
            transform: scale(1.02);
        }

        .input-field {
            background-color: #33334d;
            border: 1px solid #555577;
            color: #e0e0e0;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            outline: none;
            transition: border-color 0.3s ease;
        }
        .input-field:focus {
            border-color: #8a2be2;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8a2be2, #4b0082); /* Purple gradient */
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .btn-primary:disabled {
            background: #4a4a5a; /* Darker grey for disabled */
            cursor: not-allowed;
            box-shadow: none;
        }
        .btn-secondary {
            background-color: #33334d; /* Darker grey */
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .btn-secondary:hover {
            background-color: #444466;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        .btn-google {
            background-color: #db4437; /* Google Red */
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .btn-google:hover {
            background-color: #c23321;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* Login Modal Specific Styles */
        #loginModal .modal-content {
            background-color: #22223b; /* Darker background for login */
            border: 2px solid #8a2be2; /* Purple border */
            color: #e0e0e0;
        }
        #loginModal .input-field {
            background-color: #33334d;
            border-color: #555577;
            color: #e0e0e0;
        }
        #loginModal .input-field::placeholder {
            color: #b0b0b0;
        }
        #loginModal .text-link {
            color: #93c5fd; /* Light blue for links */
        }
        #loginModal .text-link:hover {
            color: #bfdbfe;
        }

        /* Signup Modal Specific Styles */
        #signupModal .modal-content {
            background-color: #e0e7ff; /* Lighter background for signup */
            border: 2px solid #6366f1; /* Indigo border */
            color: #374151; /* Darker text */
        }
        #signupModal .input-field {
            background-color: #f3f4f6;
            border-color: #d1d5db;
            color: #1f2937;
        }
        #signupModal .input-field::placeholder {
            color: #6b7280;
        }
        #signupModal .btn-primary {
            background: linear-gradient(135deg, #6366f1, #4f46e5); /* Indigo gradient */
        }
        #signupModal .btn-primary:hover {
            background: linear-gradient(135deg, #4f46e5, #4338ca);
        }
        #signupModal .btn-secondary {
            background-color: #d1d5db;
            color: #374151;
        }
        #signupModal .btn-secondary:hover {
            background-color: #9ca3af;
        }
        #signupModal .text-link {
            color: #4f46e5; /* Indigo for links */
        }
        #signupModal .text-link:hover {
            color: #3730a3;
        }
    </style>
</head>
<body>
    <div id="loadingScreen" class="fixed inset-0 flex items-center justify-center bg-[#1a1a2e] z-50">
        <div class="text-white text-2xl">جاري التحميل...</div>
    </div>

    <div id="loginModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-3xl font-bold mb-6">تسجيل الدخول</h2>
            <form id="loginForm">
                <div class="mb-4">
                    <input type="email" id="loginEmail" placeholder="البريد الإلكتروني" class="input-field w-full" required />
                </div>
                <div class="mb-6">
                    <input type="password" id="loginPassword" placeholder="كلمة المرور" class="input-field w-full" required />
                </div>
                <p id="loginError" class="text-red-400 text-sm mb-4 hidden">خطأ في تسجيل الدخول. يرجى التحقق من بيانات الاعتماد.</p>
                <button type="submit" id="loginBtn" class="btn-primary w-full py-3 px-6 rounded-lg font-semibold mb-3">تسجيل الدخول</button>
            </form>
            <div class="my-4 text-gray-500">أو</div>
            <button id="googleLoginBtn" class="btn-google w-full py-3 px-6 rounded-lg font-semibold">
                <i class="fab fa-google text-xl"></i> تسجيل الدخول باستخدام جوجل
            </button>
            <p class="mt-4 text-center text-gray-400 text-sm">
                ليس لديك حساب؟
                <button id="showSignupBtn" class="text-link font-semibold hover:underline focus:outline-none">إنشاء حساب</button>
            </p>
        </div>
    </div>

    <div id="signupModal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2 class="text-3xl font-bold mb-6">إنشاء حساب</h2>
            <form id="signupForm">
                <div class="mb-4">
                    <input type="email" id="signupEmail" placeholder="البريد الإلكتروني" class="input-field w-full" required />
                </div>
                <div class="mb-4">
                    <input type="password" id="signupPassword" placeholder="كلمة المرور" class="input-field w-full" required />
                </div>
                <div class="mb-6">
                    <input type="password" id="signupConfirmPassword" placeholder="تأكيد كلمة المرور" class="input-field w-full" required />
                </div>
                <p id="signupError" class="text-red-500 text-sm mb-4 hidden">خطأ في إنشاء الحساب. يرجى المحاولة مرة أخرى.</p>
                <button type="submit" id="signupBtn" class="btn-primary w-full py-3 px-6 rounded-lg font-semibold mb-3">إنشاء حساب</button>
            </form>
            <div class="my-4 text-gray-500">أو</div>
            <button id="googleSignupBtn" class="btn-google w-full py-3 px-6 rounded-lg font-semibold">
                <i class="fab fa-google text-xl"></i> إنشاء حساب باستخدام جوجل
            </button>
            <p class="mt-4 text-center text-gray-600 text-sm">
                لديك حساب بالفعل؟
                <button id="showLoginBtn" class="text-link font-semibold hover:underline focus:outline-none">تسجيل الدخول</button>
            </p>
        </div>
    </div>

    <div id="usernameModal" class="modal-overlay hidden">
        <div class="modal-content bg-[#22223b] border border-gray-700 text-white">
            <h2 class="text-3xl font-bold mb-6">اختر اسم المستخدم الخاص بك</h2>
            <div class="mb-4">
                <input type="text" id="usernameInput" placeholder="اسم_المستخدم_123" class="input-field w-full" required />
            </div>
            <p id="usernameError" class="text-red-400 text-sm mb-4 hidden">يجب أن يكون اسم المستخدم بأحرف صغيرة، بدون مسافات، مسموح فقط بالرمز '_' والأرقام. يجب أن يكون فريدًا أيضًا.</p>
            <button id="saveUsernameBtn" class="btn-primary w-full py-3 px-6 rounded-lg font-semibold">حفظ اسم المستخدم</button>
        </div>
    </div>

    <div id="dashboard" class="hidden bg-white p-8 rounded-lg shadow-xl max-w-md w-full text-center border border-gray-200">
        <h2 class="text-3xl font-bold text-gray-800 mb-4">مرحباً!</h2>
        <p class="text-lg text-gray-600 mb-6">لقد قمت بتسجيل الدخول بنجاح.</p>
        <p class="text-md text-gray-700 mb-8 break-words">
            معرف المستخدم الخاص بك: <span id="displayUserId" class="font-mono bg-gray-100 p-2 rounded-md text-sm"></span>
        </p>
        <button id="logoutBtn" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300 ease-in-out shadow-md hover:shadow-lg">
            تسجيل الخروج
        </button>
    </div>

    <script type="module">
        // استيراد حزم Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // متغيرات Firebase العامة
        let app;
        let auth;
        let db;
        let currentUserId = null;
        let currentUsername = null;
        // استخدام معرف التطبيق المقدم، أو معرف افتراضي إذا لم يتم توفيره
        // هذا هو معرف مشروع Firebase الخاص بك، ولا يجب أن يتغير إلى اسم النطاق.
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'game-1-b46e1'; 

        // --- وظائف التحكم في واجهة المستخدم ---
        function showLoadingScreen() {
            document.getElementById('loadingScreen').classList.remove('hidden');
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('signupModal').classList.add('hidden');
            document.getElementById('usernameModal').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        function showLoginModal() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('loginModal').classList.remove('hidden');
            document.getElementById('signupModal').classList.add('hidden');
            document.getElementById('usernameModal').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginError').classList.add('hidden'); // إخفاء الأخطاء السابقة
        }

        function showSignupModal() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('signupModal').classList.remove('hidden');
            document.getElementById('usernameModal').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('signupError').classList.add('hidden'); // إخفاء الأخطاء السابقة
        }

        function showUsernameModal() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('signupModal').classList.add('hidden');
            document.getElementById('usernameModal').classList.remove('hidden');
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('usernameError').classList.add('hidden'); // إخفاء الأخطاء السابقة
        }

        function showDashboard() {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('loginModal').classList.add('hidden');
            document.getElementById('signupModal').classList.add('hidden');
            document.getElementById('usernameModal').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            document.getElementById('displayUserId').textContent = currentUserId;
        }

        // --- معالجات مصادقة Firebase ---
        async function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorDisplay = document.getElementById('loginError');
            const loginBtn = document.getElementById('loginBtn');

            errorDisplay.classList.add('hidden');
            loginBtn.disabled = true;
            loginBtn.textContent = 'جاري تسجيل الدخول...';

            try {
                await signInWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged سيتولى تغيير العرض
            } catch (error) {
                console.error("خطأ في تسجيل الدخول:", error);
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                    errorDisplay.textContent = 'بريد إلكتروني أو كلمة مرور غير صحيحة. يرجى المحاولة مرة أخرى.';
                } else if (error.code === 'auth/invalid-email') {
                    errorDisplay.textContent = 'تنسيق البريد الإلكتروني غير صالح.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorDisplay.textContent = 'الكثير من محاولات تسجيل الدخول الفاشلة. يرجى المحاولة مرة أخرى لاحقًا.';
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorDisplay.textContent = 'تسجيل الدخول بالبريد الإلكتروني/كلمة المرور غير مفعل. يرجى تفعيله في إعدادات Firebase Authentication.';
                }
                else {
                    errorDisplay.textContent = 'فشل تسجيل الدخول. يرجى التحقق من بيانات الاعتماد.';
                }
                errorDisplay.classList.remove('hidden');
            } finally {
                loginBtn.disabled = false;
                loginBtn.textContent = 'تسجيل الدخول';
            }
        }

        async function handleSignup(event) {
            event.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const errorDisplay = document.getElementById('signupError');
            const signupBtn = document.getElementById('signupBtn');

            errorDisplay.classList.add('hidden');
            signupBtn.disabled = true;
            signupBtn.textContent = 'جاري إنشاء الحساب...';

            if (password !== confirmPassword) {
                errorDisplay.textContent = 'كلمات المرور غير متطابقة.';
                errorDisplay.classList.remove('hidden');
                signupBtn.disabled = false;
                signupBtn.textContent = 'إنشاء حساب';
                return;
            }

            try {
                await createUserWithEmailAndPassword(auth, email, password);
                // onAuthStateChanged سيتولى تغيير العرض
            } catch (error) {
                console.error("خطأ في إنشاء الحساب:", error);
                if (error.code === 'auth/email-already-in-use') {
                    errorDisplay.textContent = 'هذا البريد الإلكتروني مستخدم بالفعل. يرجى تسجيل الدخول أو استخدام بريد إلكتروني مختلف.';
                } else if (error.code === 'auth/invalid-email') {
                    errorDisplay.textContent = 'تنسيق البريد الإلكتروني غير صالح.';
                } else if (error.code === 'auth/weak-password') {
                    errorDisplay.textContent = 'يجب أن تتكون كلمة المرور من 6 أحرف على الأقل.';
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorDisplay.textContent = 'إنشاء الحساب بالبريد الإلكتروني/كلمة المرور غير مفعل. يرجى تفعيله في إعدادات Firebase Authentication.';
                }
                else {
                    errorDisplay.textContent = 'فشل إنشاء الحساب. يرجى المحاولة مرة أخرى.';
                }
                errorDisplay.classList.remove('hidden');
            } finally {
                signupBtn.disabled = false;
                signupBtn.textContent = 'إنشاء حساب';
            }
        }

        async function handleGoogleSignIn() {
            const provider = new GoogleAuthProvider();
            const loginErrorDisplay = document.getElementById('loginError'); // يمكن استخدام نفس مكان عرض الخطأ
            const signupErrorDisplay = document.getElementById('signupError'); // يمكن استخدام نفس مكان عرض الخطأ
            loginErrorDisplay.classList.add('hidden');
            signupErrorDisplay.classList.add('hidden');

            try {
                // عرض شاشة التحميل أثناء محاولة تسجيل الدخول
                showLoadingScreen();
                const result = await signInWithPopup(auth, provider);
                // The user's info is in result.user
                // onAuthStateChanged will handle the view change and username check
                console.log("تم تسجيل الدخول باستخدام جوجل بنجاح:", result.user);
            } catch (error) {
                console.error("خطأ في تسجيل الدخول باستخدام جوجل:", error);
                let errorMessage = 'فشل تسجيل الدخول باستخدام جوجل. يرجى المحاولة مرة أخرى.';
                if (error.code === 'auth/popup-closed-by-user') {
                    errorMessage = 'تم إغلاق نافذة تسجيل الدخول من قبل المستخدم.';
                } else if (error.code === 'auth/cancelled-popup-request') {
                     errorMessage = 'تم إلغاء طلب النافذة المنبثقة. يرجى المحاولة مرة أخرى.';
                } else if (error.code === 'auth/operation-not-allowed') {
                    errorMessage = 'تسجيل الدخول باستخدام جوجل غير مفعل. يرجى تفعيله في إعدادات Firebase Authentication.';
                } else if (error.code === 'auth/unauthorized-domain') {
                    errorMessage = 'النطاق الحالي غير مصرح به في إعدادات Firebase. يرجى إضافة النطاق (الموجود في عنوان URL للمعاينه) إلى "Authorized domains" في إعدادات Firebase Authentication.';
                }
                // عرض الخطأ في النافذة المناسبة (تسجيل الدخول أو إنشاء الحساب)
                if (!document.getElementById('loginModal').classList.contains('hidden')) {
                    loginErrorDisplay.textContent = errorMessage;
                    loginErrorDisplay.classList.remove('hidden');
                    showLoginModal(); // إعادة عرض نافذة تسجيل الدخول
                } else if (!document.getElementById('signupModal').classList.contains('hidden')) {
                    signupErrorDisplay.textContent = errorMessage;
                    signupErrorDisplay.classList.remove('hidden');
                    showSignupModal(); // إعادة عرض نافذة إنشاء حساب
                } else {
                    // إذا لم تكن أي من النافذتين مرئية، اعرض الخطأ في شاشة التحميل أو لوحة التحكم
                    alert(errorMessage); // استخدام alert المخصص
                }
            } finally {
                // إخفاء شاشة التحميل إذا لم يتم الانتقال إلى لوحة التحكم
                if (document.getElementById('loadingScreen') && !document.getElementById('dashboard').classList.contains('hidden')) {
                     // لا تفعل شيئًا، لوحة التحكم مرئية بالفعل
                } else if (document.getElementById('loadingScreen') && document.getElementById('usernameModal').classList.contains('hidden')) {
                    // إذا لم يتم الانتقال إلى لوحة التحكم أو نافذة اسم المستخدم، أعد إظهار نافذة تسجيل الدخول
                    showLoginModal();
                }
            }
        }

        async function handleSaveUsername() {
            const usernameInput = document.getElementById('usernameInput');
            const username = usernameInput.value.trim();
            const errorDisplay = document.getElementById('usernameError');
            const saveUsernameBtn = document.getElementById('saveUsernameBtn');

            errorDisplay.classList.add('hidden');
            saveUsernameBtn.disabled = true;
            saveUsernameBtn.textContent = 'جاري الحفظ...';

            // التحقق من تنسيق اسم المستخدم
            if (!/^[a-z0-9_]+$/.test(username)) {
                errorDisplay.textContent = 'يجب أن يكون اسم المستخدم بأحرف صغيرة، بدون مسافات، مسموح فقط بالرمز "_" والأرقام.';
                errorDisplay.classList.remove('hidden');
                saveUsernameBtn.disabled = false;
                saveUsernameBtn.textContent = 'حفظ اسم المستخدم';
                return;
            }

            try {
                // التحقق مما إذا كان اسم المستخدم فريدًا
                const usernameDocRef = doc(db, `artifacts/${appId}/public/data/usernames/${username}`);
                const usernameDocSnap = await getDoc(usernameDocRef);

                if (usernameDocSnap.exists()) {
                    errorDisplay.textContent = 'اسم المستخدم هذا مستخدم بالفعل. يرجى اختيار اسم آخر.';
                    errorDisplay.classList.remove('hidden');
                    saveUsernameBtn.disabled = false;
                    saveUsernameBtn.textContent = 'حفظ اسم المستخدم';
                    return;
                }

                // حفظ اسم المستخدم في ملف تعريف المستخدم وفي مجموعة أسماء المستخدمين العامة
                const userProfileDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/data`);
                await setDoc(userProfileDocRef, { username: username, userId: currentUserId }, { merge: true });
                await setDoc(usernameDocRef, { userId: currentUserId }); // وضع علامة على اسم المستخدم كمستخدم

                currentUsername = username; // تحديث اسم المستخدم العام
                showDashboard(); // الانتقال إلى لوحة التحكم
            } catch (error) {
                console.error("خطأ في حفظ اسم المستخدم:", error);
                errorDisplay.textContent = 'فشل حفظ اسم المستخدم. يرجى المحاولة مرة أخرى.';
                errorDisplay.classList.remove('hidden');
            } finally {
                saveUsernameBtn.disabled = false;
                saveUsernameBtn.textContent = 'حفظ اسم المستخدم';
            }
        }

        async function handleLogout() {
            try {
                await signOut(auth);
                // onAuthStateChanged سيتولى إظهار نافذة تسجيل الدخول
            } catch (error) {
                console.error("خطأ في تسجيل الخروج:", error);
                alert("فشل تسجيل الخروج. يرجى المحاولة مرة أخرى.");
            }
        }

        // --- التهيئة عند تحميل DOM بالكامل ---
        document.addEventListener('DOMContentLoaded', () => {
            showLoadingScreen();

            // تهيئة Firebase
            const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
            if (Object.keys(firebaseConfig).length > 0) {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // مستمع حالة المصادقة
                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        currentUserId = user.uid;
                        // التحقق مما إذا كان المستخدم لديه اسم مستخدم
                        const userDocRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/data`);
                        const userDocSnap = await getDoc(userDocRef);

                        if (userDocSnap.exists() && userDocSnap.data().username) {
                            currentUsername = userDocSnap.data().username;
                            showDashboard();
                        } else {
                            // إذا كان المستخدم قد سجل للتو باستخدام Google ولم يكن لديه اسم مستخدم
                            // محاولة استخدام اسم العرض من Google كاسم مستخدم مبدئي
                            const suggestedUsername = user.displayName ? user.displayName.toLowerCase().replace(/[^a-z0-9_]/g, '_') : '';
                            document.getElementById('usernameInput').value = suggestedUsername;
                            showUsernameModal();
                        }
                    } else {
                        currentUserId = null;
                        currentUsername = null;
                        showLoginModal();
                        // محاولة تسجيل الدخول المجهول إذا لم يتم توفير رمز مصادقة أولي
                        if (typeof __initial_auth_token === 'undefined') {
                            signInAnonymously(auth).catch(e => console.error("فشل تسجيل الدخول المجهول:", e));
                        }
                    }
                });

                // تسجيل الدخول باستخدام رمز مخصص إذا كان متاحًا
                if (typeof __initial_auth_token !== 'undefined') {
                    signInWithCustomToken(auth, __initial_auth_token)
                        .catch((error) => {
                            console.error("خطأ في تسجيل الدخول باستخدام الرمز المخصص:", error);
                            // العودة إلى تسجيل الدخول المجهول إذا فشل الرمز المخصص
                            signInAnonymously(auth).catch(console.error);
                        });
                }
            } else {
                console.warn("لم يتم العثور على تكوين Firebase. التشغيل في وضع عدم الاتصال.");
                // بديل لوضع عدم الاتصال أو التكوين المفقود
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('displayUserId').textContent = "وضع عدم الاتصال (لا يوجد اتصال بقاعدة البيانات)";
                document.getElementById('logoutBtn').disabled = true; // تعطيل تسجيل الخروج في وضع عدم الاتصال
            }

            // إرفاق مستمعي الأحداث
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('saveUsernameBtn').addEventListener('click', handleSaveUsername);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);

            document.getElementById('showSignupBtn').addEventListener('click', showSignupModal);
            document.getElementById('showLoginBtn').addEventListener('click', showLoginModal);

            // مستمعي أحداث أزرار جوجل الجديدة
            document.getElementById('googleLoginBtn').addEventListener('click', handleGoogleSignIn);
            document.getElementById('googleSignupBtn').addEventListener('click', handleGoogleSignIn);
        });
    </script>
</body>
</html>
